<!DOCTYPE HTML>
<!--[if lt IE 7]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Linux 作業系統班</title>
<meta name="description" content="A jQuery library for modern HTML presentations">
<meta name="author" content="Caleb Troughton">
<meta name="viewport" content="width=1024, user-scalable=no">
<!-- Core and extension CSS files -->
<link rel="stylesheet" href="../deck.js/core/deck.core.css">
<link rel="stylesheet" href="../deck.js/extensions/goto/deck.goto.css">
<link rel="stylesheet" href="../deck.js/extensions/menu/deck.menu.css">
<link rel="stylesheet" href="../deck.js/extensions/navigation/deck.navigation.css">
<link rel="stylesheet" href="../deck.js/extensions/status/deck.status.css">
<link rel="stylesheet" href="../deck.js/extensions/hash/deck.hash.css">
<!-- Theme CSS files (menu swaps these out) -->
<!-- <link rel="stylesheet" id="style-theme-link" href="../deck.js/themes/style/web-2.0.css"> -->
<!--<link rel="stylesheet" id="style-theme-link" href="../deck.js/themes/style/swiss.css"> -->
<link rel="stylesheet" id="style-theme-link" href="../deck.js/themes/style/neon.css">
<link rel="stylesheet" id="transition-theme-link" href="../deck.js/themes/transition/horizontal-slide.css">
<script src="../deck.js/modernizr.custom.js"></script>
<style>
    .note { display: none; }
</style>
</head>
<body class="deck-container">
<div class="slide" id="1210">
<h1>Linux 作業系統班</h1>
</div><div class="slide" id="hw2">
<h2>作業</h2>
<ul>
<li><h3>想法</h3>
<ol>
<li><p>用 <code>find</code> 找所有的 <code>.txt</code> 檔</p>
<pre><code>for file in `find "$1" -type f -name "*.txt"`
do
    ...
done
</code></pre></li>
<li><p>寫一個 function 來 recursive 搜尋檔案</p></li>
</ol></li>
<li><a href="hw.sh">範例解答</a></li>
</ul>
</div><div class="slide" id="index">
<h1>防火牆建置</h1>
</div><div class="slide" id="outline">
<h2>Outline</h2>
<ul>
<li><h3>防火牆簡介</h3></li>
<li><h3>TCP Wrapper</h3></li>
<li><h3>iptables</h3></li>
</ul>
</div><div class="slide" id="intro">
<h2>簡介</h2>
<ul>
<li><h3>保護主機安全</h3></li>
<li><h3>阻檔特定 port 的封包</h3></li>
<li><h3>阻檔特定類型的封包</h3></li>
<li><h3>阻檔特定來源的封包</h3></li>
</ul>
</div><div class="slide" id="tcpwrapper-1">
<h2>TCP Wrapper</h2>
<ul>
<li>最簡單的防火牆</li>
<li>利用 <code>/etc/hosts.allow</code> , <code>/etc/hosts.deny</code></li>
<li>需要程式支援</li>
<li>不用重啟程式即可生效</li>
</ul>
</div><div class="slide" id="tcpwrapper-2">
<h2>TCP Wrapper</h2>
<ul>
<li><p>怎麼看程式支援 <code>TCP Wrapper</code></p>
<pre><code>$ ldd /usr/sbin/sshd | grep libwrap
</code></pre></li>
<li><p>設定檔的格式</p>
<pre><code>程式名稱: 來源 IP / 網域
</code></pre></li>
<li><p>先看 <code>/etc/hosts.allow</code> 再看 <code>/etc/hosts.deny</code></p></li>
<li>若先被比對到，則不做接下來的比對</li>
</ul>
</div><div class="slide" id="tcpwrapper-3">
<h2>TCP Wrapper</h2>
<ul>
<li><p>範例：只讓 <code>140.112.x.x</code> 或來自 <code>.ntu.edu.tw</code> 的人可以 <code>ssh</code></p>
<ul>
<li><p>在 <code>/etc/hosts.allow</code></p>
<pre><code>sshd: 140.112.0.0/16 .ntu.edu.tw
</code></pre></li>
<li><p>在 <code>/etc/hosts.deny</code></p>
<pre><code>sshd: ALL
</code></pre></li>
</ul></li>
</ul>
</div><div class="slide" id="tcpwrapper-4">
<h2>TCP Wrapper</h2>
<ul>
<li><p>範例：不讓 <code>192.168.x.x</code> 的人可以 <code>ssh</code></p>
<ul>
<li><p>在 <code>/etc/hosts.allow</code> 裡不用寫東西</p></li>
<li><p>在 <code>/etc/hosts.deny</code></p>
<pre><code>sshd: 192.168.0.0/16
</code></pre></li>
</ul></li>
</ul>
</div><div class="slide" id="tcpwrapper-5">
<h2>TCP Wrapper</h2>
<ul>
<li><h3>練習</h3>
<ul>
<li>試著不讓旁邊的人 <code>ssh</code> 進你的電腦</li>
<li>注意 Wifi 要連到同一個</li>
</ul></li>
</ul>
</div><div class="slide" id="iptable-1">
<h2>iptables</h2>
<ul>
<li>本身由 Linux kernel 所提供</li>
<li>效能好</li>
<li>Table, Chain, Rule </li>
<li class="slide"><h3>最好在本機上進行防火牆的練習！</h3></li>
</ul>
</div><div class="slide" id="iptable-2">
<h2>iptables</h2>
<ul>
<li><p>最常用到的 Table</p>
<ul>
<li><code>filter</code> 與進入 Linux 本機的封包有關</li>
<li><code>nat</code> Network Address Translation</li>
</ul></li>
<li><p>顯示 Table 的規則</p>
<pre><code># iptables -t Table名稱 -L
# iptables-save -t Table名稱
</code></pre></li>
</ul>
</div><div class="slide" id="iptable-3">
<h2>iptables</h2>
<pre><code># iptables -L
Chain INPUT (policy ACCEPT)
target     prot opt source    destination
Chain FORWARD (policy ACCEPT)
target     prot opt source    destination
Chain OUTPUT (policy ACCEPT)
target     prot opt source    destination
</code></pre>
</div><div class="slide" id="iptable-4">
<h2>iptables</h2>
<pre><code># iptables-save -t filter
# Generated by iptables-save v1.4.10 on Sat Dec 17
*filter
:INPUT ACCEPT [516:79544]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [40:1454]
COMMIT
# Completed on Sat Dec 17
</code></pre>
</div><div class="slide" id="iptable-5">
<h2>iptables</h2>
<ul>
<li><h3>Policy</h3>
<ul>
<li>若所有 Rule 皆不符合，會執行的動作</li>
</ul></li>
<li><h3>Rule</h3>
<ul>
<li>一行一條向下比對，若符合即執行相對應的動作</li>
</ul></li>
</ul>
</div><div class="slide" id="iptable-6">
<h2>iptables</h2>
<ul>
<li><h3>清除所有 Rule</h3>
<pre><code># iptables -F
</code></pre></li>
<li><h3>清除自訂的 Table / Chain</h3>
<pre><code># iptables -X
</code></pre></li>
</ul>
</div><div class="slide" id="iptable-7">
<h2>iptables</h2>
<ul>
<li><h3>改 Policy</h3>
<pre><code># iptables -P INPUT DROP
</code></pre></li>
<li><p>注意大小寫， <code>INPUT</code> 和 <code>DROP</code> 都要大寫</p></li>
</ul>
</div><div class="slide" id="iptable-8">
<h2>iptables</h2>
<pre><code># iptables-save -t filter
# Generated by iptables-save v1.4.10 on Sat Dec 17
*filter
:INPUT DROP [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
COMMIT
# Completed on Sat Dec 17
</code></pre>
</div><div class="slide" id="iptable-9">
<h2>iptables</h2>
<ul>
<li><h3>練習</h3>
<ul>
<li>先把 <code>/etc/hosts.allow</code> , <code>/etc/hosts.deny</code> 改回來</li>
<li>把 <code>INPUT</code> Policy 設成 <code>DROP</code> ，試著不讓旁邊的人用 <code>ssh</code> 連進來</li>
<li>請旁邊的人用瀏覽器，網址打上你的 ip ，看看是不是沒辦法看到網頁</li>
<li>把 <code>INPUT</code> 給 <code>DROP</code> 之後，你應該也不能上網了，因為網頁的回應沒辦法傳進來</li>
</ul></li>
</ul>
</div><div class="slide" id="iptable-10">
<h2>iptables</h2>
<ul>
<li><h3>新增 Rule</h3>
<pre><code># iptables -A [Chain名稱] [-i/-o 網路介面] [-p tcp,udp,icmp] [-s 來源IP] [--sport 來源port] [-d 目標IP] [--dport 目標port] -j [ACCEPT,DROP,REJECT,LOG]
</code></pre></li>
<li><h3>參數</h3>
<ul>
<li><code>-I</code> 把 Rule 加在第一條</li>
<li><code>-A</code> 把 Rule 加在最後一條（最晚被執行）</li>
<li><code>-j LOG</code> 不會對封包做任何動作，會把封包記錄到 <code>/var/log/syslog</code></li>
</ul></li>
</ul>
</div><div class="slide" id="iptable-11">
<h2>iptables</h2>
<ul>
<li><h3>新增 Rule ，開放 port 22 給 192.168.x.x 的人，並同時記錄下封包</h3>
<pre><code># iptables -A INPUT -i eth0 -p tcp -s 192.168.0.0/16 --dport 22 -j LOG
# iptables -A INPUT -i eth0 -p tcp -s 192.168.0.0/16 --dport 22 -j ACCEPT
</code></pre></li>
<li><p>記得要先寫 <code>LOG</code> 的 Rule ，如果順序錯了就不會有記錄</p></li>
<li>再次和旁邊的人合作，看看有沒有成功打開 port 22</li>
<li>請旁邊的人再開瀏覽器看看能不能看到（目前應該要看不到）</li>
</ul>
</div><div class="slide" id="iptable-12">
<h2>iptables</h2>
<pre><code># iptables-save -t filter
# Generated by iptables-save v1.4.10 on Sat Dec 17
*filter
:INPUT DROP [31:5195]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [20:3118]
-A INPUT -s 192.168.0.0/16 -i eth0 -p tcp -m tcp --dport 22 -j LOG 
-A INPUT -s 192.168.0.0/16 -i eth0 -p tcp -m tcp --dport 22 -j ACCEPT 
COMMIT
# Completed on Sat Dec 17
</code></pre>
</div><div class="slide" id="iptable-13">
<h2>iptables</h2>
<ul>
<li><h3>練習</h3>
<ul>
<li>除了 <code>ssh</code> (port 22) 之外，試著把 port 80 也打開</li>
<li>再請旁邊的同學開瀏覽器試最後一次吧！</li>
</ul></li>
</ul>
</div><div class="slide" id="iptable-14">
<h2>iptables</h2>
<ul>
<li><h3>狀態模組</h3>
<ul>
<li>可以得知封包所處的連線的狀態</li>
<li>通常已建立的封包，或和自己發出的封包有關係的，都需要被 ACCEPT</li>
<li>像我們發出的網頁要求，對方網頁伺服器的回應應該要被 ACCEPT</li>
</ul></li>
</ul>
</div><div class="slide" id="iptable-15">
<h2>iptables</h2>
<ul>
<li><h3>狀態模組</h3>
<pre><code># iptables -A INPUT -m state --state [INVALID,ESTABLISHED,NEW,RELATED] -j [ACCEPT,DROP,REJECT,LOG]
</code></pre></li>
<li><h3>參數</h3>
<ul>
<li><code>-m</code> 使用模組</li>
</ul></li>
</ul>
</div><div class="slide" id="iptable-16">
<h2>iptables</h2>
<ul>
<li><h3>設定</h3>
<pre><code># iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
</code></pre></li>
<li><p><code>RELATED</code> 由自己發出去的封包有關的</p></li>
<li><code>ESTABLISHED</code> 已建立的連線</li>
</ul>
</div><div class="slide" id="iptable-17">
<h2>iptables</h2>
<ul>
<li><h3>mac 模組</h3>
<ul>
<li><p>利用網卡來封住來自特定機器的封包</p>
<pre><code># iptables -I INPUT -m mac --mac-source aa:bb:cc:dd:ee:ff -j DROP
</code></pre></li>
</ul></li>
</ul>
</div><div class="slide" id="iptable-18">
<h2>iptables</h2>
<ul>
<li><h3>編輯 iptables Rule</h3>
<ul>
<li><h4>麻煩</h4>
<ul>
<li>沒辦法刪除單一 Rule</li>
<li>每次都要全部刪掉重加</li>
</ul></li>
</ul></li>
<li class="slide"><p><h3>寫個 Shell Script 吧！</p></h3></li>
</ul>
</div><div class="slide" id="iptable-19">
<h2>iptables</h2>
<pre><code>iptables -F
iptables -X
iptables -P INPUT DROP
iptables -P OUTPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT
iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables-save -t filter
</code></pre>
</div><div class="slide" id="iptable-20">
<h2>iptables</h2>
<ul>
<li><h3>NAT (Network Address Translation)</h3>
<ul>
<li>轉換內部區網的 IP/port 對應到對外的連線</li>
</ul></li>
</ul>
<div></div>
<pre><code># echo "1" &gt; /proc/sys/net/ipv4/ip_forward
# iptables -t nat -A POSTROUTING -o 對外網路介面 -s 內部網路介面 -j MASQUERADE
</code></pre>
</div><div class="slide" id="iptable-21">
<h2>iptables</h2>
<ul>
<li><h3>Port Knocking</h3>
<ul>
<li>只想在特定的時候開啟某些服務</li>
<li>增加安全性</li>
<li>避免被 port scan 找出特定服務的 port</li>
</ul></li>
</ul>
</div><div class="slide" id="iptable-22">
<h2>iptables</h2>
<ul>
<li><h3>Port Knocking</h3>
<ul>
<li>連線時必須照特定的順序 <code>敲門</code> 才可以開啟特定的 port</li>
<li>例如：要先用 TCP 連上 port 6000 ，接著連上 port 7000 ，
這時候 port 22 才會開啟 10 秒</li>
</ul></li>
</ul>
</div><div class="slide" id="iptable-23">
<h2>iptables</h2>
<ul>
<li><h3>Port Knocking</h3></li>
</ul>
<div></div>
<pre><code># iptables -A INPUT -p tcp --dport 6000 -m recent --set --name knock1
</code></pre>
<div></div>
<pre><code># iptables -A INPUT -p tcp --dport 7000 -m recent --rcheck --name knock1 -m recent --set --name knock2
</code></pre>
</div><div class="slide" id="iptable-23">
<h2>iptables</h2>
<ul>
<li><h3>Port Knocking</h3></li>
</ul>
<div></div>
<pre><code># iptables -A INPUT -p tcp --dport 22 -m recent --rcheck --seconds 10 --name knock2 -j ACCEPT
</code></pre>
<div></div>
<pre><code># iptables -A INPUT -p tcp --dport 22 -m recent --name knock1 --remove
</code></pre>
</div><div class="slide" id="ec2-index">
<h1>雲端 Linux 平台</h1>
</div><div class="slide" id="ec2-intro">
<h2>雲端 Linux 平台</h2>
<ul>
<li><h3>優點</h3>
<ul>
<li>穩定</li>
<li>擴充性</li>
</ul></li>
<li><h3>缺點</h3>
<ul>
<li>機器不在身邊</li>
<li><h3>$$$</h3></li>
</ul></li>
</ul>
</div><div class="slide" id="ec">
<h2>Amazon Elastic Compute Cloud (EC2)</h2>
<ul>
<li>不用自己灌 Linux</li>
<li>不用買主機</li>
<li><p>不用申請固定 ip</p></li>
<li class="slide"><p><h3>第一年免費</p></h3></li>
</ul>
</div><div class="slide" id="ec-2">
<h2>Amazon Elastic Compute Cloud (EC2)</h2>
<p><img src="free.png" alt="free" title="" /></p>
</div><div class="slide" id="ec-3">
<h2>Amazon Elastic Compute Cloud (EC2)</h2>
<ul>
<li><h3><a href="http://aws.amazon.com/">http://aws.amazon.com/</a></h3></li>
</ul>
</div><div class="slide" id="ec-4">
<h1>Amazon Elastic Compute Cloud (EC2)</h1>
</div>
<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>
<p class="deck-status">
    台大資訊系統訓練班 Linux 作業系統班&nbsp;&nbsp;&nbsp;&nbsp;
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="number" name="slidenum" id="goto-slide">
	<input type="submit" value="Go">
</form>

<a href="." title="Permalink to this slide" class="deck-permalink">#</a>

<script src="../deck.js/jquery.js"></script>
<script>window.jQuery || document.write('<script src="../deck.js/jquery-1.6.1.min.js">\x3C/script>')</script>
<script>
$(document).bind('deck.change', function(event, from, to) {
    slide = $.deck('getSlide', to);
    note = $(slide).find('.note').html();
    if (typeof noteWindow != 'undefined') {
        noteWindow.document.body.innerHTML = "";
    }
    if (note) {
        if (typeof noteWindow == 'undefined') {
            noteWindow = window.open('', 'note');
            noteWindow.blur();
            window.focus();
        }
        noteWindow.document.write("<h1>備忘：</h1>");
        noteWindow.document.write("<h3>");
        noteWindow.document.write(note);
        noteWindow.document.write("</h3>");
    }
});
</script>

<!-- Deck Core and extensions -->
<script src="../deck.js/core/deck.core.js"></script>
<script src="../deck.js/extensions/menu/deck.menu.js"></script>
<script src="../deck.js/extensions/goto/deck.goto.js"></script>
<script src="../deck.js/extensions/status/deck.status.js"></script>
<script src="../deck.js/extensions/navigation/deck.navigation.js"></script>
<script src="../deck.js/extensions/hash/deck.hash.js"></script>
<script> $(function() {$.deck('.slide');}); </script>
</body>
</html>

<!DOCTYPE HTML>
<!--[if lt IE 7]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Network </title>
<meta name="description" content="A jQuery library for modern HTML presentations">
<meta name="author" content="Caleb Troughton">
<meta name="viewport" content="width=1024, user-scalable=no">
<!-- Core and extension CSS files -->
<link rel="stylesheet" href="../deck.js/core/deck.core.css">
<link rel="stylesheet" href="../deck.js/extensions/goto/deck.goto.css">
<link rel="stylesheet" href="../deck.js/extensions/menu/deck.menu.css">
<link rel="stylesheet" href="../deck.js/extensions/navigation/deck.navigation.css">
<link rel="stylesheet" href="../deck.js/extensions/status/deck.status.css">
<link rel="stylesheet" href="../deck.js/extensions/hash/deck.hash.css">
<!-- Theme CSS files (menu swaps these out) -->
<!-- <link rel="stylesheet" id="style-theme-link" href="../deck.js/themes/style/web-2.0.css"> -->
<link rel="stylesheet" id="style-theme-link" href="../deck.js/themes/style/neon.css">
<link rel="stylesheet" id="transition-theme-link" href="../deck.js/themes/transition/horizontal-slide.css">
<script src="../deck.js/modernizr.custom.js"></script>
</head>
<body class="deck-container">
<div class="slide" id="index">
<h1>Linux 系統訓練班</h1>
</div><div class="slide" id="Outline">
<h2>Outline</h2>
<ul>
<li><h3>Process/Resource management</h3></li>
<li><h3>FTP</h3>
<ul>
<li>ProFTPd, vsFTPd</li>
</ul></li>
<li><h3>FTP Installation</h3></li>
</ul>
</div><div class="slide" id="ProcessManagement">
<h2>Process Management</h2>
<ul>
<li><h3>Job control</h3></li>
<li><h3>Process/Resource</h3></li>
<li><h3>Priority</h3></li>
<li><h3>Permission</h3></li>
</ul>
</div><div class="slide" id="JobControl">
<h2>Job Control</h2>
<ul>
<li><code>背景</code>執行
<ul>
<li>command &amp;</li>
</ul></li>
</ul>
<div></div>
<ul>
<li><code>暫停</code>執行 
<ul>
<li>ctrl + z</li>
</ul></li>
</ul>
<div></div>
<ul>
<li><code>中斷</code>執行 
<ul>
<li>ctrl + c</li>
</ul></li>
</ul>
</div><div class="slide" id="JobControl-1">
<h2>Job Control, cont.</h2>
<ul>
<li><code>jobs</code>
<ul>
<li>查看目前背景中的工作</li>
</ul></li>
<li><code>fg</code>
<ul>
<li>將背景中工作移至前景並執行</li>
</ul></li>
<li><code>bg</code>
<ul>
<li>將背景中工作執行</li>
</ul></li>
<li><code>kill</code>
<ul>
<li>刪除執行的工作</li>
</ul></li>
</ul>
</div><div class="slide" id="JobControl-2">
<h2>JobControl, cont.</h2>
<pre><code>$ vim
</code></pre>
<div></div>
<ul>
<li>Press <code>ctrl + z</code></li>
</ul>
<div></div>
<pre><code>[1]+  Stopped                 vim
</code></pre>
<div></div>
<pre><code>$ sleep 1000 &amp;
$ jobs
</code></pre>
</div><div class="slide" id="JobControl-3">
<h2>JobControl, cont.</h2>
<ul>
<li><code>Stopped</code>, <code>Running</code>
<ul>
<li>Stopped - 暫停執行</li>
<li>Running - 背景執行</li>
</ul></li>
<li><code>+/-</code>
<ul>
<li><ul>
<li>最近一個被放入背景工作</li>
</ul></li>
<li><ul>
<li>倒數第二個被放入背景工作</li>
</ul></li>
</ul></li>
</ul>
</div><div class="slide" id="JobControl-4">
<h2>JobControl, cont.</h2>
<ul>
<li><code>fg</code> 將背景工作拉回前景執行</li>
</ul>
<div></div>
<pre><code>$ fg 
$ fg +
</code></pre>
<div></div>
<pre><code>$ fg -
</code></pre>
<div></div>
<pre><code>$ fg %num
</code></pre>
</div><div class="slide" id="JobControl-5">
<h2>JobControl, cont.</h2>
<ul>
<li><code>bg</code> 將背景工作拉回前景執行</li>
</ul>
<div></div>
<pre><code>$ bg 
$ bg +
</code></pre>
<div></div>
<pre><code>$ bg -
</code></pre>
<div></div>
<pre><code>$ bg %num
</code></pre>
</div><div class="slide" id="JobControl-6">
<h2>JobControl, cont.</h2>
<ul>
<li><code>kill</code> 刪除執行的工作</li>
</ul>
<div></div>
<pre><code>$ kill %jobnumber
$ kill -9 %jobnumber
$ kill -15 %jobnumber
</code></pre>
<div></div>
<pre><code>$ kill -l
</code></pre>
</div><div class="slide" id="processresouce">
<h2>process and resource</h2>
<ul>
<li><code>process status</code></li>
</ul>
<div></div>
<pre><code>$ ps u
$ ps au
$ ps aux
$ ps auxf
</code></pre>
<div></div>
<pre><code>$ bash * 5
$ ps uxf
</code></pre>
</div><div class="slide" id="processresouce1">
<h2>process and resource</h2>
<ul>
<li><code>process status</code></li>
</ul>
<div></div>
<pre><code>$ ptree
$ ptree -up
</code></pre>
<div></div>
<pre><code>$ bash * 5
$ pstree -up
</code></pre>
</div><div class="slide" id="ProcessResouce-1">
<h2>Process and Resource, cont.</h2>
<ul>
<li><code>刪除</code>執行的工作</li>
</ul>
<div></div>
<pre><code>$ kill PID
$ kill -9 PID
$ kill -15 PID
</code></pre>
<div></div>
<pre><code>$ killall vim
$ killall -9 vim
</code></pre>
</div><div class="slide" id="ProcessResouce-2">
<h2>Process and Resource, cont.</h2>
<ul>
<li><code>資源</code>管理</li>
</ul>
<div></div>
<pre><code>$ free
$ dmesg
$ df
$ vmstat
</code></pre>
</div><div class="slide" id="ProcessResouce-3">
<h2>Process and Resource, cont.</h2>
<ul>
<li><code>free</code> 記憶體資訊</li>
</ul>
<div></div>
<pre><code>             total   used   free   shared  buffers  cached
Mem:           595    561     33        0       86     404
-/+ buffers/cache:     71    524
Swap:            0      0      0
</code></pre>
<ul>
<li>-buffers/cache: <code>used</code> - <code>buffers</code> - <code>cached</code>
<ul>
<li>process實際佔去的記憶體空間</li>
</ul></li>
<li>+buffers/cache: <code>free</code> + <code>buffers</code> + <code>cached</code>
<ul>
<li>可挪用的記憶體空間</li>
</ul></li>
<li>swap <code>used</code> 越高表示系統效能越差
<ul>
<li>該擴充記憶體了！</li>
</ul></li>
</ul>
</div><div class="slide" id="ProcessResouce-4">
<h2>Process and Resource, cont.</h2>
<ul>
<li>利用<code>dmesg</code>找出<code>CPU時脈</code>以及<code>記憶體</code>大小</li>
</ul>
<div></div>
<pre><code>$ dmesg | less
</code></pre>
<div></div>
<ul>
<li>keyword: <code>Memory</code> and <code>processor</code></li>
</ul>
</div><div class="slide" id="ProcessResouce-5">
<h2>Process and Resource, cont.</h2>
<ul>
<li><code>vmstat</code> - Report virtual memory statistics</li>
</ul>
<div></div>
<pre><code>$ man vmstat
</code></pre>
</div><div class="slide" id="Priority">
<h2>Priority</h2>
<ul>
<li>執行時的<code>優先權</code>設定</li>
</ul>
<div></div>
<pre><code>$ nice -n niceness command
$ renice niceness PID
</code></pre>
</div><div class="slide" id="Permission">
<h2>Permission</h2>
<ul>
<li><code>SUID</code> - Set UID bit</li>
</ul>
<div></div>
<pre><code>$ chmod u+s file
</code></pre>
<div></div>
<ul>
<li><code>SGID</code> - Set GID bit</li>
</ul>
<div></div>
<pre><code>$ chmod g+s file
</code></pre>
</div><div class="slide" id="Permission1">
<h2>Permission, cont.</h2>
<ul>
<li>例如: <code>passwd</code>, 密碼儲存於/etc/shadow
<ul>
<li>使用者更改密碼為何可以寫入/etc/shadow呢?</li>
</ul></li>
</ul>
<div></div>
<pre><code>-rw-r----- 1 root 1101 2011-12-10 09:12 /etc/shadow
</code></pre>
</div><div class="slide" id="Permission2">
<h2>Permission, cont.</h2>
<ul>
<li>例如: <code>passwd</code>, 密碼儲存於/etc/shadow
<ul>
<li>因為<code>setuid bit</code>設定/usr/bin/passwd使得執行時擁有root權限</li>
</ul></li>
</ul>
<div></div>
<pre><code>-rw-r----- 1 root 1101 2011-12-10 09:12 /etc/shadow
</code></pre>
<div></div>
<pre><code>-rwsr-xr-x 1 root root 41284 2011-06-24 09:36 /usr/bin/passwd
</code></pre>
</div><div class="slide" id="Permission4">
<h2>Permission, cont.</h2>
<pre><code>$ cp `which sh` ~
# chown root ~/sh
# chmod u+s ~/sh
$ ~/sh
</code></pre>
</div><div class="slide" id="Permission3">
<h2>Permission, cont.</h2>
<ul>
<li>搜尋系統中有<code>setuid</code>的file</li>
</ul>
<div></div>
<pre><code>sudo find / -type f -perm +4000 -exec ls -l {} \;
</code></pre>
<p>* 搜尋系統中有<code>setgid</code>的file</p>
<div></div>
<pre><code>sudo find / -type f -perm +2000 -exec ls -l {} \;
</code></pre>
<p>* 該如何搜尋同時<code>setuid &amp; setgid</code>的file呢？</p>
</div><div class="slide" id="FileIO">
<h2>File IO</h2>
<ul>
<li><code>fuesr</code> 找出正在使用該檔案的程序</li>
</ul>
<div></div>
<pre><code>$ fuser -uv ./
</code></pre>
</div><div class="slide" id="FileIO1">
<h2>File IO, cont.</h2>
<ul>
<li>例如: <code>umount</code>時出現錯誤訊息</li>
</ul>
<div></div>
<pre><code># cd /home/hcsu/haha
# umount /home/hcsu/haha
umount: /home/hcsu/haha: device is busy.
$ fuser -uv /tmp/mnt
                     USER        PID ACCESS COMMAND
/home/hcsu/haha:     root     kernel mount (root)/
                     hcsu      30621 .rc.. (hcsu)bash
</code></pre>
</div><div class="slide" id="FTP">
<h1>FTP</h1>
</div><div class="slide" id="FTP-1">
<h2>FTP - server</h2>
<ul>
<li><h3>File Transfer Protocol</h3></li>
<li><code>檔案傳輸</code>的伺服器</li>
</ul>
</div><div class="slide" id="FTP-2">
<h2>FTP - client</h2>
<ul>
<li><h3>Linux</h3>
<ul>
<li><code>ftp</code>, ...</li>
</ul></li>
</ul>
<div></div>
<ul>
<li><h3>Windows</h3>
<ul>
<li><code>Filezilla</code>, ...</li>
</ul></li>
</ul>
</div><div class="slide" id="FTP-3">
<h2>FTP - intro</h2>
<ul>
<li><code>user</code>, <code>anonymous</code>
<ul>
<li>ftp user 權限較完整(rw)</li>
<li>anonymous 權限限制較多(r)</li>
</ul></li>
</ul>
<div></div>
<ul>
<li>change root (<code>chroot</code>)
<ul>
<li>限制使用者活動資料夾</li>
</ul></li>
</ul>
</div><div class="slide" id="FTP-4">
<h2>FTP - connection mode</h2>
<ul>
<li><h3>由用戶端選擇</h3></li>
<li><code>active mode</code> 主動模式
<ul>
<li>port 21, 20</li>
</ul></li>
<li><code>passive mode</code> 被動模式
<ul>
<li>port 21, random port</li>
</ul></li>
</ul>
</div><div class="slide" id="FTP-5">
<h2>FTP - active mode</h2>
<ul>
<li>client &lt;--> server port <code>21</code></li>
<li>client --<code>Active</code>,<code>client port</code>--> server port <code>21</code></li>
<li>client <code>port</code>&lt;--> server port <code>20</code> (data)</li>
</ul>
</div><div class="slide" id="FTP-6">
<h2>FTP - passive mode</h2>
<ul>
<li>client &lt;--> server port <code>21</code></li>
<li>client --<code>PASV</code>--> server port <code>21</code></li>
<li>client &lt;--<code>random port</code>-- server port <code>21</code></li>
<li>client &lt;--> server <code>random port</code> (data)</li>
</ul>
</div><div class="slide" id="FTP-install">
<h2>Installation</h2>
<ul>
<li><code>Download</code> first</li>
</ul>
<div></div>
<pre><code>$ showmount -e 192.168.50.113
# mount 192.168.50.113:/Users/atdog/Desktop/Train_linux/source /tmp/mnt
$ cp /tmp/mnt/proftpd-1.3.4rc3.tar.gz ~/
# umount /tmp/mnt
$ tar -zxvf proftpd-1.3.4rc3.tar.gz
</code></pre>
</div><div class="slide" id="FTP-install1">
<h2>Installation, cont.</h2>
<ul>
<li>由<code>原始碼</code>編譯,並<code>安裝</code></li>
</ul>
<div></div>
<pre><code>$ cd proftpd-1.3.4rc3
$ ./configure
$ make
# make install
$ /usr/local/sbin/proftpd
</code></pre>
<div></div>
<pre><code>$ ftp localhost
</code></pre>
</div><div class="slide" id="FTP-configuration">
<h2>Configuration</h2>
<ul>
<li>Config file <code>proftpd.conf</code>
<ul>
<li>路徑 <code>/usr/local/etc/proftpd.conf</code></li>
</ul></li>
</ul>
<div></div>
<pre><code># vim /usr/local/etc/proftpd.conf
</code></pre>
</div><div class="slide" id="FTP-configuration1">
<h2>Configuration, cont.</h2>
<ul>
<li><h3>ServerName</h3>
<ul>
<li>伺服器名稱</li>
</ul></li>
<li><h3>ServerType</h3>
<ul>
<li>自行啟動或透過inetd啟動</li>
</ul></li>
<li><h3>DefaultServer</h3>
<ul>
<li>是否為預設伺服器</li>
</ul></li>
<li><h3>Port</h3>
<ul>
<li>服務連接埠</li>
</ul></li>
</ul>
</div><div class="slide" id="FTP-configuration2">
<h2>Configuration, cont.</h2>
<ul>
<li><h3>UserIPv6</h3>
<ul>
<li>是否支援IPv6</li>
</ul></li>
<li><h3>Umask</h3>
<ul>
<li>022 prevent from being group and world writable</li>
</ul></li>
<li><h3>MaxInstances</h3>
<ul>
<li>child process 個數</li>
</ul></li>
<li><h3>User, Group</h3>
<ul>
<li>proftpd執行權限</li>
</ul></li>
</ul>
</div><div class="slide" id="FTP-configuration3">
<h2>Configuration, cont.</h2>
<ul>
<li><h3>DefaultRoot</h3>
<ul>
<li>change root to directory</li>
</ul></li>
<li><h3>AllowOverWrite</h3>
<ul>
<li>上傳的檔案可否被覆寫</li>
</ul></li>
<li><h3>SITE_CHMOD</h3>
<ul>
<li>DenyAll - ftp內不能chmod</li>
</ul></li>
<li><h3>Anonymous</h3>
<ul>
<li>匿名使用者登入設定</li>
</ul></li>
</ul>
</div><div class="slide" id="FTP-practice">
<h2>FTP practice - ServerName</h2>
<ul>
<li><h3>設定ServerName</h3></li>
</ul>
<div></div>
<pre><code># vim /usr/local/etc/proftpd.conf
</code></pre>
<div></div>
<ul>
<li><code>ServerName</code></li>
</ul>
<div></div>
<pre><code>$ ps uax | grep ftp
$ kill -1 PID
</code></pre>
</div><div class="slide" id="FTP-practice1">
<h2>FTP practice - chroot</h2>
<ul>
<li><h3>設定chroot</h3></li>
</ul>
<div></div>
<pre><code># vim /usr/local/etc/proftpd.conf
</code></pre>
<div></div>
<ul>
<li><code>DefaultRoot</code></li>
</ul>
<div></div>
<pre><code>$ ps uax | grep ftp
$ kill -1 PID
</code></pre>
</div><div class="slide" id="FTP-practice2">
<h2>FTP practice - overwrite</h2>
<ul>
<li><h3>設定Overwrite</h3></li>
</ul>
<div></div>
<pre><code># vim /usr/local/etc/proftpd.conf
</code></pre>
<div></div>
<ul>
<li><code>AllowOverWrite</code></li>
</ul>
<div></div>
<pre><code>$ ps uax | grep ftp
$ kill -1 PID
</code></pre>
</div><div class="slide" id="Game">
<h2>Gaming time</h2>
<ul>
<li>小明昨天經過大家指正後，終於把行事曆的問題解決了，小明很開心！於是小明又繼續增加功能，這次他加入了<code>相簿功能</code>，希望大家能夠透過他的<code>ftp</code>把照片傳上去，小明認為這次設定很完美，沒想到又被拿到帳號密碼，害小明既傷心又難過，聰明的你能幫小明找到他的問題麻？</li>
<li><a href="http://game.dm4.tw" title="Game">小明的網站</a> </li>
<li>ftp: <code>game.dm4.tw</code></li>
<li>帳號/密碼: <code>ftpuser</code>/<code>1234</code></li>
<li>hint1: chroot很完美，cgi好像怪怪的喔！</li>
<li>hint2: +x 好像就可以執行了</li>
<li>hint3: 一次一個script去try好像太慢了</li>
<li>hint4: 該不會..不只一個.cgi吧？</li>
</ul>
</div><div class="slide" id="end">
<h1>Q&amp;A</h1>
</div>
<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>
<p class="deck-status">
    Hung-Chi Su (atdog)&nbsp;&nbsp;&nbsp;&nbsp;
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="number" name="slidenum" id="goto-slide">
	<input type="submit" value="Go">
</form>

<a href="." title="Permalink to this slide" class="deck-permalink">#</a>

<script src="../deck.js/jquery.js"></script>
<script>window.jQuery || document.write('<script src="../deck.js/jquery-1.6.1.min.js">\x3C/script>')</script>

<!-- Deck Core and extensions -->
<script src="../deck.js/core/deck.core.js"></script>
<script src="../deck.js/extensions/menu/deck.menu.js"></script>
<script src="../deck.js/extensions/goto/deck.goto.js"></script>
<script src="../deck.js/extensions/status/deck.status.js"></script>
<script src="../deck.js/extensions/navigation/deck.navigation.js"></script>
<script src="../deck.js/extensions/hash/deck.hash.js"></script>
<script> $(function() {$.deck('.slide');}); </script>
</body>
</html>
